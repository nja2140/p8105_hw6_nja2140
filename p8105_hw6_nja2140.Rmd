---
title: "p8105_hw6_nja2140"
author:  Naina Ahuja
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(modelr)
library(mgcv)
library(purrr)
set.seed(10)
```

Problem 1: Load and clean the data for regression analysis (i.e. convert numeric to factor where appropriate, check for missing data, etc.).
```{r}
baby_data=
  read_csv("./Data/birthweight.csv") %>% 
  janitor::clean_names() %>%
  mutate(babysex = factor(babysex, levels =  c("1", "2"), labels = c("male", "female")),
         frace = factor(frace, levels =  c("1", "2", "3", "4", "8", "9"), labels = c("white", "black", "asian", "puerto rican", "other", "unknown")),
         malform = factor(malform, levels =  c("0", "1"), labels = c("absent", "present")),
         mrace = factor(mrace, levels =  c("1", "2", "3", "4", "8"), labels = c("white", "black", "asian", "puerto rican", "other"))
          )
baby_data
```
Propose a regression model for birthweight. This model may be based on a hypothesized structure for the factors that underly birthweight, on a data-driven model-building process, or a combination of the two. Describe your modeling process and show a plot of model residuals against fitted values â€“ use add_predictions and add_residuals in making this plot.

To figure out the regression model for birthweight, I will run a regression on each individual variable and see which is statistically significantly associated with birthweight. Only the variables that are statistically significant will be included in the regression model. 

```{r}
mp1 = lm(bwt ~ babysex, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp2 = lm(bwt ~ bhead, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp3 = lm(bwt ~ blength, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp4 = lm(bwt ~ delwt, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp5 = lm(bwt ~ fincome, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp6 = lm(bwt ~ frace, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp7 = lm(bwt ~ gaweeks, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp8 = lm(bwt ~ malform, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp9 = lm(bwt ~ menarche, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp10 = lm(bwt ~ mheight, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp11 = lm(bwt ~ momage, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp12 = lm(bwt ~ mrace, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp13 = lm(bwt ~ parity, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp14 = lm(bwt ~ pnumlbw, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp15 = lm(bwt ~ pnumsga, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp16 = lm(bwt ~ ppbmi, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp17 = lm(bwt ~ ppwt, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp18 = lm(bwt ~ smoken, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
mp19 = lm(bwt ~ wtgain, data = baby_data) %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) 
```

```{r}
fit = lm(bwt ~ babysex + bhead + blength + delwt + fincome + frace + gaweeks + mheight + momage + mrace + pnumlbw + pnumsga + ppbmi + ppwt + smoken + wtgain, data = baby_data) 
fit
```

```{r}
plot_1 = 
  baby_data %>% 
  modelr::add_residuals(fit) %>% 
  modelr::add_predictions(fit) %>% 
  ggplot(aes(x = pred, y = resid)) +
  geom_point ()
plot_1
```
Compare your model to two others:

One using length at birth and gestational age as predictors (main effects only)
One using head circumference, length, sex, and all interactions (including the three-way interaction) between these

```{r}
fit_1 = lm(bwt ~ blength + gaweeks, data = baby_data) %>% 
  broom::tidy() %>% 
  knitr::kable()
```

```{r}
fit_2 = lm(bwt ~ bhead + blength + babysex + bhead*blength + bhead*babysex + babysex*blength + bhead*blength*babysex, data = baby_data) %>% 
  broom::tidy() %>% 
  knitr::kable()
```
Make this comparison in terms of the cross-validated prediction error; use crossv_mc and functions in purrr as appropriate.

```{r}
cv_df = 
  crossv_mc(baby_data, 100) 

cv_df = 
  cv_df %>% 
  mutate(fit = map(train, ~lm(bwt ~ babysex + bhead + blength + delwt + fincome + frace + gaweeks + mheight + momage + mrace + pnumlbw + pnumsga + ppbmi + ppwt + smoken + wtgain, data = .x)),
         fit_1 = map(train, ~lm(bwt ~blength + gaweeks, data = .x)),
         fit_2 = map(train, ~lm(bwt ~ bhead + blength + babysex + bhead*blength + bhead*babysex + babysex*blength + bhead*blength*babysex, data = .x))) %>% 
  mutate(rmse_fit = map2_dbl(fit, test, ~rmse(model = .x, data = .y)),
         rmse_fit_1 = map2_dbl(fit_1, test, ~rmse(model = .x, data = .y)),
         rmse_fit_2 = map2_dbl(fit_2, test, ~rmse(model = .x, data = .y)))

cv_df %>% 
  select(starts_with("rmse")) %>% 
  pivot_longer(
    everything (),
    names_to = "model", 
    values_to = "rmse", 
    names_prefix = "rmse_") %>% 
  mutate(model - fct_inorder(model)) %>% 
  ggplot(aes(x = model, y = rmse)) +
  geom_violin ()
```



